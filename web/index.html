<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TrafficPulse (MVP)</title>

    <link rel="stylesheet" href="styles.css" />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
  </head>
  <body>
    <header class="topbar">
      <div class="title">
        <h1>TrafficPulse</h1>
        <div class="subtitle">VD-based congestion exploration (MVP)</div>
      </div>
      <div class="status" id="status">Ready.</div>
    </header>

    <main class="layout">
      <section class="sidebar">
        <div class="panel">
          <div class="panel-title">Data Source</div>
          <div class="panel-body small">
            API: <span class="mono" id="api-base"></span>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Segment</div>
          <div class="panel-body">
            <label class="field">
              <span class="label">Search</span>
              <input id="segment-search" type="text" placeholder="Filter by name or ID" />
            </label>
            <label class="field">
              <span class="label">Select</span>
              <select id="segment-select"></select>
            </label>
            <div class="segment-info" id="segment-info">No segment selected.</div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Corridor</div>
          <div class="panel-body">
            <label class="field">
              <span class="label">Select</span>
              <select id="corridor-select"></select>
            </label>
            <div class="segment-info" id="corridor-info">No corridor selected.</div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Time Range</div>
          <div class="panel-body">
            <label class="field">
              <span class="label">Entity</span>
              <select id="entity-type">
                <option value="segment" selected>Segment</option>
                <option value="corridor">Corridor</option>
              </select>
            </label>
            <label class="field">
              <span class="label">Start (local)</span>
              <input id="start" type="datetime-local" />
            </label>
            <label class="field">
              <span class="label">End (local)</span>
              <input id="end" type="datetime-local" />
            </label>
            <label class="field">
              <span class="label">Granularity</span>
              <select id="minutes">
                <option value="5">5-min</option>
                <option value="15" selected>15-min</option>
                <option value="60">Hourly</option>
              </select>
            </label>
            <button class="button" id="load">Load timeseries</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Rankings</div>
          <div class="panel-body">
            <label class="field">
              <span class="label">Type</span>
              <select id="ranking-type">
                <option value="segments" selected>Segments (unreliable)</option>
                <option value="corridors">Corridors (unreliable)</option>
              </select>
            </label>
            <label class="field">
              <span class="label">Limit</span>
              <select id="ranking-limit">
                <option value="20" selected>Top 20</option>
                <option value="50">Top 50</option>
                <option value="100">Top 100</option>
              </select>
            </label>
            <button class="button" id="load-rankings">Load rankings</button>
            <div class="rankings" id="rankings"></div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Events</div>
          <div class="panel-body">
            <button class="button" id="load-events">Load events (map bounds)</button>
            <div class="events" id="events"></div>
            <div class="segment-info" id="event-info">No event selected.</div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Help</div>
          <div class="panel-body small">
            <ul class="list">
              <li>Click a marker on the map or use the dropdown to select a segment.</li>
              <li>Pick a time range and load the time series.</li>
              <li>Use the Events panel to load incident markers and impact summaries.</li>
              <li>
                You can override API base URL with <span class="mono">?api=http://localhost:8000</span>.
              </li>
            </ul>
          </div>
        </div>
      </section>

      <section class="content">
        <div class="map" id="map"></div>
        <div class="chart">
          <div class="chart-title">Time Series</div>
          <div class="chart-body" id="chart"></div>
        </div>
      </section>
    </main>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="https://cdn.plot.ly/plotly-2.27.1.min.js"></script>
    <script src="app.js"></script>
  </body>
</html>
